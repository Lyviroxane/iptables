# Generated by iptables-save v1.8.7 on [current date]
*filter

# Step 1: Empty existing rules
# Flush all existing rules
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]

# Step 2: Deny all connections by default
# Set default policy to DROP to block all incoming and outgoing connections
-P INPUT DROP
-P OUTPUT DROP
-P FORWARD DROP

# Step 4: Authorize established connections
# Allow established or related connections
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# Step 5: Allow loopback connections (localhost)
# Allow loopback interface for local communication
-A INPUT -i lo -j ACCEPT
-A OUTPUT -o lo -j ACCEPT

# Step 6: Allow pings (ICMP)
# Enable ping requests (ICMP)
-A INPUT -p icmp --icmp-type echo-request -j ACCEPT
-A OUTPUT -p icmp --icmp-type echo-reply -j ACCEPT

# Step 7: Allow SSH connections (port 22)
# Allow SSH (secure remote login)
-A INPUT -p tcp --dport 22 -j ACCEPT
-A OUTPUT -p tcp --sport 22 -j ACCEPT

# Step 8: Allow DNS traffic (port 53)
# Enable DNS for domain resolution (both TCP and UDP)
-A INPUT -p udp --dport 53 -j ACCEPT
-A OUTPUT -p udp --sport 53 -j ACCEPT
-A INPUT -p tcp --dport 53 -j ACCEPT
-A OUTPUT -p tcp --sport 53 -j ACCEPT

# Step 9: Allow HTTP and HTTPS traffic (ports 80 and 443)
# Enable HTTP and HTTPS for web traffic
-A INPUT -p tcp --dport 80 -j ACCEPT
-A OUTPUT -p tcp --sport 80 -j ACCEPT
-A INPUT -p tcp --dport 443 -j ACCEPT
-A OUTPUT -p tcp --sport 443 -j ACCEPT

COMMIT
# Completed on [current date]
